<!DOCTYPE html>
<html>



<body>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script>
var query={}
var totalPage;
var type="url";
function move(n){
if(type=="url")
	search(query.page+n);
	else searchFile(query.page+n);
}

function search(q){
type="url";
if(q==null){
query={};
query.url=$('#url').val();
}
else{
query.page=q;
}
$.get("search/url",query,callback

)
}

function searchFile(q){
type="file";
if(q==null){
query={};
data=new FormData();
data.append("file0",$('#path')[0].files[0]);
$.ajax({
url:"search/file",
success:callback,
type:"POST",
data:data,
contentType:false,
processData: false
})
}
else{
query.page=q;
$.ajax({
url:"search/file",
success:callback,
type:"GET",
data:query,
})
}
}

var callback=function(data){
	query.query_id=data.query_id;
	query.page=data.pageNum;
	totalPage=data.numOfPages;
	var list=data.data.hits;
	var text="";
	var prev='<button type="button" onclick="move(-1)">prev</td>'
	var next='<button type="button" onclick="move(1)">next</td>'
	text+="<div>"
console.log("page"+query.page);
if(query.page>=1)text+=prev;
if(query.page<totalPage-1)text+=next;
	text+="</div>"
	for(i in list){
		text+='<p>' +  list[i].meta.title +'</p>';
		text+='<img src="'+list[i].meta.thumb+'"></img><br>';
	}
	$("#imgs").html(text);
}
</script>

<form action="javascript:void(0)" method=POST enctype="multipart/form-data">
    <table><tr>
     <td>Search URL:</td>
     <td><input name="query_url" id="url"></input></td>
     <td><button type="button" onclick="search()">Submit</td>
     <td>&nbsp;&nbsp;or upload File:</td>
     <td><input type="file" name="file0" id="path"/></td>
     <td><button type="button" onclick="searchFile()">_Submit</td>
    </table></tr>
</form>
<div id="imgs">
</div>
<br/>
</html>
